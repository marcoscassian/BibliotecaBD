{% extends "base.html" %}

{% block title %}Auditoria{% endblock %}

{% block css %}
<link rel="stylesheet" href="{{ url_for('static', filename='geral_list.css') }}">
<style>
    .badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.85em;
        font-weight: bold;
    }
    .badge-insert {
        background-color: #28a745;
        color: white;
    }
    .badge-update {
        background-color: #ffc107;
        color: #212529;
    }
    .badge-delete {
        background-color: #dc3545;
        color: white;
    }
    .tabela-auditoria {
        font-size: 0.95em;
    }
    .tabela-auditoria td {
        vertical-align: middle;
    }
    .info-triggers {
        background-color: #e7f3ff;
        border: 1px solid #b6d4fe;
        border-radius: 4px;
        padding: 15px;
        margin-bottom: 20px;
    }
    .info-triggers h4 {
        margin: 0 0 10px 0;
        color: #0c5460;
    }
    .info-triggers ul {
        margin: 0;
        padding-left: 20px;
    }
    .info-triggers li {
        margin-bottom: 5px;
    }
</style>
{% endblock %}

{% block content %}
<div class="topo">
    <h2>üìã Auditoria do Sistema</h2>
</div>

<div class="info-triggers">
    <h4>‚ÑπÔ∏è Logs registrados automaticamente pelos triggers:</h4>
    <ul>
        <li><strong>Usu√°rios:</strong> Cadastro e altera√ß√£o de dados</li>
        <li><strong>Empr√©stimos:</strong> Novos empr√©stimos e devolu√ß√µes</li>
        <li><strong>Livros:</strong> Exclus√£o de livros do sistema</li>
    </ul>
</div>

<table class="tabela tabela-auditoria">
    <thead>
        <tr>
            <th>ID</th>
            <th>Data/Hora</th>
            <th>Tabela</th>
            <th>Opera√ß√£o</th>
            <th>Usu√°rio Relacionado</th>
            <th>Descri√ß√£o</th>
        </tr>
    </thead>
    <tbody>
        {% for log in logs %}
        <tr>
            <td>{{ log.id_log }}</td>
            <td>{{ log.data_operacao.strftime('%d/%m/%Y %H:%M:%S') if log.data_operacao else '-' }}</td>
            <td>{{ log.tabela_afetada | capitalize }}</td>
            <td>
                {% if log.operacao == 'INSERT' %}
                    <span class="badge badge-insert">INSERT</span>
                {% elif log.operacao == 'UPDATE' %}
                    <span class="badge badge-update">UPDATE</span>
                {% elif log.operacao == 'DELETE' %}
                    <span class="badge badge-delete">DELETE</span>
                {% else %}
                    {{ log.operacao }}
                {% endif %}
            </td>
            <td>{{ log.nome_usuario or "‚Äî" }}</td>
            <td>{{ log.descricao }}</td>
        </tr>
        {% else %}
        <tr>
            <td colspan="6" style="text-align: center; padding: 20px; color: #666;">
                Nenhum log de auditoria registrado ainda.
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
